<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pink Sky Checker</title>
<meta name="description" content="Quickly tells you whether a chosen day's sunset in your area has the right clouds & air for vivid pink/blue afterglow." />
<meta name="theme-color" content="#f7e8f6">

<style>
  /* --- layout & typography --- */
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#071425}
  :root{
    --pad: clamp(16px,4.2vw,36px);
    --bg-top:#f4f9ff; --bg-bottom:#fff6fb; --card:#ffffff; --muted:#6b7280;
    --pink:#ff78b6; --purple:#b08bff; --blue:#6e9bff;
    --radius:16px;
    --title-min:28px; --title-max:44px;
  }
  body{
    background: linear-gradient(180deg,var(--bg-top),var(--bg-bottom));
    padding-top: calc(var(--pad) + env(safe-area-inset-top, 0px));
    padding-bottom: calc(var(--pad) + env(safe-area-inset-bottom, 0px));
    padding-left: calc(var(--pad) + env(safe-area-inset-left, 0px));
    padding-right: calc(var(--pad) + env(safe-area-inset-right, 0px));
    -webkit-font-smoothing:antialiased;
  }

  .wrap{max-width:980px;margin:0 auto}
  /* Title above card (big, gradient text) */
  .title {
    display:inline-block;margin-bottom:18px;padding:12px 20px;border-radius:30px;
    font-weight:900;
    font-size: clamp(var(--title-min), 6.5vw, var(--title-max));
    color:transparent; -webkit-background-clip:text;
    background-image: linear-gradient(90deg,var(--pink),var(--purple),var(--blue));
    text-shadow: 0 6px 20px rgba(107,119,255,0.06);
  }

  /* Card */
  .card{
    background:var(--card);
    border-radius:calc(var(--radius) + 2px);
    padding:18px;
    box-shadow: 0 18px 40px rgba(8,18,40,0.08);
    border:1px solid rgba(8,15,40,0.04);
  }
  .lead{color:var(--muted);margin-bottom:12px;font-size:15px}

  label{display:block;margin:8px 0 6px;font-weight:800;color:#051026}
  .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .controls.col{flex-direction:column;align-items:stretch}
  input,select{padding:12px;border-radius:12px;border:1px solid rgba(8,15,40,0.06);font-size:16px;min-height:46px}
  input::placeholder{color:#a8b0bc}

  /* Gradient buttons — original size */
  .btn{
    background: linear-gradient(90deg,var(--pink),var(--purple),var(--blue));
    color:white;border:0;padding:14px 18px;border-radius:14px;font-weight:800;cursor:pointer;
    box-shadow: 0 8px 22px rgba(107,119,255,0.08);min-height:46px;font-size:16px;
  }
  .btn.large{width:100%}

  /* Results */
  .result{margin-top:18px;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(245,251,255,0.98), rgba(255,248,252,0.98));border:1px solid rgba(99,102,241,0.04)}
  .score-row{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .score-left{min-width:0}
  .score-title{font-weight:900;font-size:20px;margin-bottom:6px}
  .verdict{font-weight:800;color:#243046;margin-bottom:8px}
  .tagline{color:var(--muted);margin-bottom:8px}
  .details{color:var(--muted);margin-top:6px}

  .pill{display:inline-block;padding:.42rem .66rem;border-radius:999px;color:white;font-weight:900;background:var(--pink);min-width:42px;text-align:center;box-shadow:0 8px 20px rgba(110,155,255,0.12);font-size:16px}

  .tips{margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,244,248,0.85), rgba(237,245,255,0.85));border:1px solid rgba(107,119,255,0.04);font-size:15px;color:#243046}

  .legend{margin-top:10px;color:#6b7280;font-size:14px}

  footer{margin-top:26px;text-align:center;color:var(--muted);font-size:14px}

  /* small screens: stack controls */
  @media (max-width:720px){
    .controls{flex-direction:column;align-items:stretch}
    .title{font-size:34px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">Pink Sky Checker</div>

    <div class="card" role="main" aria-labelledby="title">
      <div class="lead">Pick a location and a day — quick verdict + a single Photo-ready score (1–10).</div>

      <label for="locInput">Location</label>
      <div class="controls" id="controlsRow">
        <button id="useLoc" class="btn" aria-label="Use my location">Use my location</button>
        <input id="locInput" placeholder="Type a city, neighborhood or ZIP (e.g. Chevy Chase, MD)" />
        <select id="daySelect" title="Choose day" aria-label="Choose day"></select>
      </div>

      <div style="margin-top:12px">
        <button id="checkBtn" class="btn large" aria-label="Check sunset conditions">Check</button>
      </div>

      <div id="output" class="result" style="display:none" aria-live="polite"></div>

      <div id="tipsBox" class="tips" style="display:none"></div>

      <div class="legend">Score is 1–10 photo-readiness (1 = unlikely, 10 = very likely).</div>
    </div>

    <footer>Made with soft gradients and stubborn optimism ☁️</footer>
  </div>

<script>
/* ------------------ Utilities & storage ------------------ */
const STORAGE = 'pinksky_location_v1';

function saveLocation(label, lat, lon){
  try{ localStorage.setItem(STORAGE, JSON.stringify({label,lat,lon})); }
  catch(e){ console.warn('save fail',e); }
}
function loadLocation(){
  try{ const s = localStorage.getItem(STORAGE); return s? JSON.parse(s) : null; } catch(e){ return null; }
}
function dayLabel(d){
  const today = new Date(), dd = new Date(today.getFullYear(), today.getMonth(), today.getDate()+d);
  const opts = {month:'numeric', day:'numeric'};
  if(d===0) return `Today (${dd.toLocaleDateString(undefined,opts)})`;
  if(d===1) return `Tomorrow (${dd.toLocaleDateString(undefined,opts)})`;
  return `${dd.toLocaleDateString(undefined,{weekday:'short',month:'numeric',day:'numeric'})}`;
}
function clamp(n,a,b){ return Math.max(a,Math.min(b,n)); }

/* ------------------ UI setup ------------------ */
const locInput = document.getElementById('locInput');
const useLocBtn = document.getElementById('useLoc');
const daySelect = document.getElementById('daySelect');
const checkBtn = document.getElementById('checkBtn');
const output = document.getElementById('output');
const tipsBox = document.getElementById('tipsBox');

(function populateDays(){
  for(let i=0;i<7;i++){
    const o = document.createElement('option'); o.value = i; o.textContent = dayLabel(i); daySelect.appendChild(o);
  }
})();

(function restoreSaved(){
  const s = loadLocation();
  if(s) locInput.value = s.label || '';
})();

/* ------------------ Geocoding helpers (Nominatim) ------------------ */
async function geocodePlace(q){
  const url = 'https://nominatim.openstreetmap.org/search?format=json&limit=1&q=' + encodeURIComponent(q);
  try{
    const r = await fetch(url, {headers:{'Accept-Language':'en'}});
    const j = await r.json();
    if(j && j[0]) return {lat:+j[0].lat, lon:+j[0].lon, label: j[0].display_name};
  }catch(e){ console.warn('geocode fail',e); }
  return null;
}
async function reverseGeocode(lat, lon){
  const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10`;
  try{
    const r = await fetch(url, {headers:{'Accept-Language':'en'}});
    const j = await r.json();
    if(j && j.address){
      const a=j.address;
      const city = a.city || a.town || a.village || a.county || '';
      const state = a.state || a.region || '';
      const postcode = a.postcode ? (' ' + a.postcode) : '';
      const label = (city ? city + (state ? ', ' + state : '') : (j.display_name || 'Your location')) + postcode;
      return {label};
    }
  }catch(e){ console.warn('reverse fail', e); }
  return null;
}

/* ------------------ Open-Meteo fetch & scoring ------------------ */
function buildOpenMeteoUrls(lat, lon){
  // Try richer hourly fields first, fallback to simpler
  const base = (f) => `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&timezone=auto&daily=sunrise,sunset&hourly=${f}`;
  return [
    base('cloudcover,cloudcover_high,cloudcover_mid,cloudcover_low,pm2_5'),
    base('cloudcover,pm2_5'),
    base('cloudcover')
  ];
}
async function fetchForecast(lat, lon){
  const urls = buildOpenMeteoUrls(lat,lon);
  for(const u of urls){
    try{
      const r = await fetch(u);
      const j = await r.json();
      // minimal validation
      if(j && j.hourly && j.hourly.time && j.daily && j.daily.sunset) return j;
    }catch(e){ console.warn('open-meteo fail',e); }
  }
  return null;
}

/* find hour index nearest to target date/time */
function nearestHourIndex(timesISO, targetDate){
  let bestIdx=0, best=1e18;
  for(let i=0;i<timesISO.length;i++){
    const d = Math.abs(new Date(timesISO[i]).getTime()) - targetDate.getTime();
  }
  return 0;
}
</script>
</body>
</html>